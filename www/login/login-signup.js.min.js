var myApp=angular.module("sample.login-signup",["ui.router","auth0"])
myApp.config(["$stateProvider","$urlRouterProvider","authProvider",function(o,n,e){o.state("login",{url:"/login",controller:"LoginSignupController",templateUrl:"login/login.html",data:{requiresLogin:!1}}),o.state("login_success",{url:"/login_success",controller:"LoginSuccessContoller",templateUrl:"login/login_success.html",params:{accessToken:"",idToken:""},data:{requiresLogin:!1}}),o.state("signup",{url:"/signup",controller:"LoginSignupController",templateUrl:"login/signup.html",data:{requiresLogin:!1}})}]),myApp.controller("LoginSuccessContoller",["auth","$scope","BackandService","$state","$stateParams","growl","AUTH_CONSTANT","USER_TYPE",function(o,n,e,l,s,i,c,t){function r(o){var n={}
n.user_id=o.data[0].id,n.user_type=o.data[0].user_type,n.first_name=o.data[0].first_name,n.last_name=o.data[0].last_name,console.log("User In Session"),console.log(n),window.localStorage.setItem("UserInSession",JSON.stringify(n))}function a(o){e.getUserByAuthId(o).then(function(e){n.user=e.data[0],console.log(e.data[0]),null==e.data[0]?(console.log("New User - > "+o),n.isNew=!0):(r(e),n.isNew=!1),i.success("",{title:"Login Success!"}),n.loading=!1,l.go("home")})}function g(o,e){var l=new Auth0({domain:c.AUTH0_DOMAIN,clientID:c.AUTH0_CLIENT_ID,callbackOnLocationHash:!0})
l.getProfile(e,function(o,e){if(console.log(o),console.log(e),null!=o&&(n.error=o),null!=e){n.authProfile=e,console.log(n.authProfile)
var l={}
l.email=e.email,l.auth_id=e.user_id,l.picture=e.picture,l.picture_large=e.picture_large,e.cover&&(l.cover_photo=e.cover.source),l.nickname=e.nickname,window.localStorage.setItem("AuthProfile",JSON.stringify(l)),a(l.auth_id)}})}n.users=[],n.user=[],n.isNew=null,n.user_type="new",n.loading=!0,console.log(s.accessToken),g(s.accessToken,s.idToken)}]),myApp.controller("LoginSignupController",["auth","$scope","$state","BackandService","growl","AUTH_CONSTANT",function(o,n,e,l,s,i){console.log("aaa")
var c=new Auth0({domain:i.AUTH0_DOMAIN,clientID:i.AUTH0_CLIENT_ID,callbackOnLocationHash:!0,sso:!0})
n.logout=function(){c.logout(),e.go("login")},n.loginInfo={},n.login=function(o){c.login({connection:i.AUTH0_DB_CONNECTION_NAME,email:n.loginInfo.email,password:n.loginInfo.password},function(o,n){o&&(console.log(o),s.error(""+o,{title:"Login Error!"})),null!=n&&(console.log(n),e.go("login_success",{accessToken:n.accessToken,idToken:n.idToken}))})},n.loginFacebook=function(o){c.login({connection:"facebook"},function(o,n){o&&(console.log(o),s.error(""+o,{title:"Login Error!"})),null!=n&&(console.log(n),e.go("login_success",{accessToken:n.accessToken,idToken:n.idToken}))})},n.loginGoogle=function(o){c.login({connection:"google-oauth2"},function(o,n){o&&(console.log(o),s.error(""+o,{title:"Login Error!"})),null!=n&&(console.log(n),e.go("login_success",{accessToken:n.accessToken,idToken:n.idToken}))})},n.signupInfo={},n.signup=function(o){function l(o,n,l){console.log(o),console.log(n),console.log(l),o&&(console.log("Something went wrong signing up: "+o),s.error(""+o,{title:"Signup Failed!"}),console.error(o)),n&&(s.success("",{title:"Successfully signed up!"}),e.go("login_success",{accessToken:n.accessToken,idToken:n.idToken}))}c.signup({sso:!1,auto_login:!0,connection:i.AUTH0_DB_CONNECTION_NAME,email:n.signupInfo.email,password:n.signupInfo.password},l)}}])

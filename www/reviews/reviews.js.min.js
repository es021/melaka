var myApp=angular.module("sample.reviews",["ui.router","backand","auth0","ngCookies"])
myApp.config(["$stateProvider",function(e){e.state("addEditReview",{url:"/addEditReview?to_user_id&product_id&id&show",controller:"ReviewController",templateUrl:"reviews/addEditReview.html",data:{requiresLogin:!0}})}]),myApp.controller("ReviewController",["$scope","USER_TYPE","$ionicPopup","SearchService","NOTI_CATEGORY","UserService","PublicService","BackandService","auth","OFFSET","$state","$location","$stateParams",function(e,i,t,o,n,a,d,r,s,l,u,c,w){function v(i){r.getObjectById("reviews",i).then(function(i){(i.status=200)&&(e.newReview=i.data)},function(e){d.errorCallbackFunction(e,"default")})}function R(i,t){r.getTotalReview(i,t).then(function(i){console.log("getTotalReview"),console.log(i.data[0].total_review),(i.status=200)&&(e.totalReviews=i.data[0].total_review)},function(e){d.errorCallbackFunction(e,"default")})}function f(i,t,o){e.loadGet=!0,r.getAllReviewsByToUserId(i,o).then(function(i){console.log("getAllReviewsByToUserId"),console.log(i.data),200==i.status&&(0==e.reviews.length?e.reviews=i.data:e.reviews=e.reviews.concat(i.data),e.loadedReviews=e.reviews.length,console.log(e.reviews)),e.loadGet=!1},function(i){d.errorCallbackFunction(i,"default"),e.loadGet=!1})}function g(i,t,o){var a="",d="/myProfile",s=0,l=e.userInSession.first_name
a=null==t?l+" "+o+" a review on your profile.":l+" "+o+" a review on your product.",s=n.REVIEW,r.createNotification(i,a,d,s)}e.reviews=[],e.newReview={},e.show=w.show,e.pageNumber=1,e.loadGet=!1,e.loadAdd=!1,e.OFFSET=l,e.totalReviews=0,e.loadedReviews=0,e.main=function(){e.userInSession=JSON.parse(window.localStorage.getItem("UserInSession")),"addEditReview"==u.current.name&&(e.to_user_id=w.to_user_id,null!=w.id&&v(w.id)),"showUser"==u.current.name&&(f(w.id,null,e.pageNumber),R(w.id,null),e.to_user_id=w.id),"myProfile"==u.current.name&&(f(e.userInSession.user_id,null,e.pageNumber),R(e.userInSession.user_id,null))},e.refresh=function(){e.reviews=[],e.main()},e.main(),e.addReview=function(e,i){console.log(e),u.go("addEditReview",{show:"Add",to_user_id:e})},e.editReview=function(e){u.go("addEditReview",{show:"Edit",id:e})},e.confirmDelete=function(i){function o(){r.deleteObject("reviews",i).then(function(i){200==i.status&&(d.successCallbackFunction("","Successfully Delete 1 Review"),e.refresh())},function(e){d.errorCallbackFunction(e,"default")})}var n=t.confirm({title:"Delete Review",template:"Are you sure?"})
n.then(function(e){e&&o(i)})},e.editReviewRecord=function(){e.loadAdd=!0,e.newReview.updated_at=d.getTimestampinMysql(),console.log(e.newReview),r.editReviewById(e.newReview.id,e.newReview.text,e.newReview.star,e.newReview.updated_at).then(function(i){console.log("editReviewById"),console.log(i.data),200==i.status&&(d.successCallbackFunction("Click on [Reviews] to refresh","Successfully Edit Review"),u.pageNumber=1,g(e.newReview.to_user_id,null,"edit"),u.go("showUser",{id:e.newReview.to_user_id})),e.loadAdd=!1},function(i){d.errorCallbackFunction(i,"default"),e.loadAdd=!1})},e.addReviewRecord=function(){e.loadAdd=!0,e.newReview.from_user_id=e.userInSession.user_id,e.newReview.to_user_id=w.to_user_id,e.newReview.product_id=w.product_id,e.newReview.created_at=d.getTimestampinMysql(),e.newReview.updated_at=d.getTimestampinMysql(),console.log(e.newReview),r.addObject("reviews",e.newReview).then(function(i){console.log("addReviews"),console.log(i.data),200==i.status&&(d.successCallbackFunction("Click on [Reviews] to refresh","Successfully Add Review"),u.pageNumber=1,g(e.to_user_id,null,"add"),u.go("showUser",{id:e.to_user_id})),e.loadAdd=!1},function(i){d.errorCallbackFunction(i,"default"),e.loadAdd=!1})},e.getMore=function(){console.log(e.pageNumber),e.pageNumber+=1,e.main()}}])

<ion-view>
<ion-content class="text-center has-header has-footer padding">
<p>
<div ng-if="stateName=='myActiveListing'" >
<h2 class="title">My Active Listing</h2>
    <button class="button button-small button-clear button-positive" ng-click="goTo('myCompletedTransaction')">See My Completed Transactions</button>
</div>
<div ng-if="stateName=='myCompletedTransaction'">
<h2 class="title">My Completed Transaction</h2>
    <button class="button button-small button-clear button-positive" ng-click="goTo('myActiveListing')">See My Active Listing</button>
</div>
      <!-- ******************************************************************************************************************************* -->

      <ion-list class="text-left">
        <div ng-repeat="item in activeListing">
            <a class="item item-icon-left item-icon-right" ng-click="toggleItem(item)" ng-class="{active: isItemShown(item)}">
		    
		    <i ng-if="stateName=='myActiveListing'" class="icon ion-load-a"></i>
		    <i ng-if="stateName=='myCompletedTransaction'" class="icon ion-android-checkmark-circle"></i>
			
			{{item.product_name}} 

			<h5 ng-if="userInSession.user_type=='agent'" class="text-muted"> requested to {{item.supplier_name}}</h5>
			<h5 ng-if="userInSession.user_type=='supplier'" class="text-muted"> requested from {{item.agent_name}}</h5>

       	<!-- ******************************************************************************************************************************* -->
        <!--STATUS AND PAYMENT STATUS SHOW ************************************************************************************************* -->
		    <span ng-if="stateName=='myActiveListing'" class="badge">
		    <span  ng-if="item.status == TRANS_STATUS.REQUESTED">
		      Requested/ 
		    </span>
		    <span ng-if="item.status == TRANS_STATUS.DENIED">
		      Denied/
		    </span>
		   	<span ng-if="item.status == TRANS_STATUS.APPROVED">
		      Approved/
		    </span>
		    <span ng-if="item.status == TRANS_STATUS.DELIVERED">
		      Delivered/
		    </span>
		   	<span ng-if="item.status == TRANS_STATUS.RECEIVED">
		      Package Received/
		    </span>

		    <span ng-if="item.payment_status == TRANS_STATUS.NOT_PAID">
		      Not Paid
		    </span>
		   	<span ng-if="item.payment_status == TRANS_STATUS.PAID">
		      Paid
		    </span>
		   	<span ng-if="item.payment_status == TRANS_STATUS.COMFIRMED">
		      Payment Comfirmed
		    </span>
		    </span>
		    <!--<i class="icon ion-ios-telephone-outline"></i>-->
		  	</a>
		
		<!-- ******************************************************************************************************************************* -->
		<!-- ******************************************************************************************************************************* -->
        <!--EXPAND ************************************************************************************************************************* -->
          <ion-item ng-show="isItemShown(item)">
			    <h2 ><strong>{{item.product_name}}</strong></h2>
				    
				    <h3 ng-if="userInSession.user_type=='agent'">requested to 
				    	<a ng-controller="UserController" ng-click="showObjectFunction('suppliers',{{item.supplier_id}})">{{item.supplier_name}}</a>
					</h3 ng-if="userInSession.user_type=='supplier'">

					<h3 ng-if="userInSession.user_type=='supplier'">requested from 
				    	<a ng-controller="UserController" ng-click="showObjectFunction('agents',{{item.agent_id}})">{{item.agent_name}}</a>
					</h3>
					
					<h4>
						Updated	{{timeAgo}}
					</h4>

				<br>
				

				  <!-- ******************************************************************************************************************************* -->
				  <!--- STATUS AND PAYMENT STATUS FOR AGENT ****************************************************************************************** -->
				  	<!-- GENERAL STATUS -->
					<button ng-if="showItem.status == TRANS_STATUS.REQUESTED" 
					class="button button-small button-balanced icon-left ion-checkmark-round">Requested</button>

					<button ng-if="showItem.status == TRANS_STATUS.APPROVED" 
					class="button button-small button-balanced icon-left ion-checkmark-round">Approved</button>

					<button ng-if="showItem.status == TRANS_STATUS.DELIVERED" 
					class="button button-small button-balanced icon-left ion-paper-airplane">Delivered</button>

					<button ng-if="showItem.status == TRANS_STATUS.DENIED" 
					class="button button-small button-assertive icon-left ion-close-round">Denied</button>
    				
    				<button ng-if="showItem.status == TRANS_STATUS.RECEIVED" 
					class="button button-small button-positive icon-left ion-archive">Package Received</button>

					<button ng-if="showItem.payment_status == TRANS_STATUS.NOT_PAID && showItem.status > TRANS_STATUS.DENIED" 
					class="button button-small button-assertive icon-left ion-cash">Not Paid</button>
    				
    				<button ng-if="showItem.payment_status == TRANS_STATUS.PAID" 
					class="button button-small button-balanced icon-left ion-cash">Paid</button>

    				<button ng-if="showItem.payment_status == TRANS_STATUS.COMFIRMED" 
					class="button button-small button-positive icon-left ion-cash">Payment Comfirmed</button>
    				
    				<div style="padding:3px"></div>
					<!-- ******************************************************************************************************************************* -->
					<!-- ACTION FOR AGENT **********************************************************************************************************-->
				  <div ng-if="userInSession.user_type == 'agent'">
										
					<button ng-if="showItem.status == TRANS_STATUS.DELIVERED"
					ng-click="updateTrans({{showItem.id}},'status',TRANS_STATUS.RECEIVED)" 
					class="button button-small button-outline button-positive icon-left ion-archive">Comfirm Package</button>
				
					<button ng-if="showItem.payment_status == TRANS_STATUS.NOT_PAID && showItem.status > TRANS_STATUS.DENIED " 
					ng-click="updateTrans({{showItem.id}},'payment_status',TRANS_STATUS.PAID)" 
					class="button button-small button-outline button-balanced icon-left ion-cash">Pay Now</button>			

					<button ng-if="showItem.status == TRANS_STATUS.DENIED || showItem.status == TRANS_STATUS.REQUESTED" 
					ng-click="deleteTrans({{showItem.id}})" 
					class="button button-small button-outline button-assertive icon-left ion-close-round">Remove Request</button>			
		
				  </div>

				  <!-- ******************************************************************************************************************************* -->
				  <!--- ACTION FOR SUPPLIER *************************************************************************************** -->
				  <div ng-if="userInSession.user_type == 'supplier'">
     
					<button ng-if="showItem.status == TRANS_STATUS.REQUESTED" 
					ng-click="updateTrans({{showItem.id}},'status',TRANS_STATUS.APPROVED)" 
					class="button button-small button-outline button-balanced icon-left ion-checkmark-round">Approve</button>
				
					<button ng-if="showItem.status == TRANS_STATUS.REQUESTED" 
					ng-click="updateTrans({{showItem.id}},'status',TRANS_STATUS.DENY)"
					class="button button-small button-outline button-assertive icon-left ion-close-round">Deny</button>
    	
					<button ng-if="showItem.status == TRANS_STATUS.APPROVED"
					ng-click="updateTrans({{showItem.id}},'status',TRANS_STATUS.DELIVERED)" 
					class="button button-small button-outline button-balanced icon-left ion-paper-airplane">Deliver</button>
    	
					<button ng-if="showItem.payment_status == TRANS_STATUS.PAID" 
					ng-click="updateTrans({{showItem.id}},'payment_status',TRANS_STATUS.COMFIRMED)" 
					class="button button-small button-outline button-balanced icon-left ion-checkmark-round">Confirm Payment</button>
    	
				  </div>

			    <br>

			    <!--- TRANSACTION INFO ************************************************************************************************************* -->
				    <h4><strong>Price Per Unit</strong> | RM {{showProduct.price_per_unit}}</h4>
				    <h4><strong>Quantity</strong> | {{showItem.quantity}}</h4>
				    <h4><strong>Type</strong> | {{showItem.type}}</h4>
				    <h4><strong>Total Price</strong> | RM {{showItem.total_price}} </h4>  

				    <h4><strong>Category</strong> | {{showProduct.category}}</h4>

				</div>
          </ion-item>
        </div>

      </ion-list>
  
  <div class="text-center" ng-show="loading">
    <img id="mySpinner" src="/img/loader.gif"/>
  </div>
  
  <div ng-if="activeListing.length == 0">
    	No active listing available
  </div>
</p>
</ion-view>
</ion-content>
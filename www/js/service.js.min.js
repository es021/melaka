var myApp=angular.module("sample.service",["ui.router","backand"])
myApp.service("BackandService",["$http","Backand","auth","USER_TYPE","OFFSET",function(e,t,r,a,o){function n(e){return t.getApiUrl()+i+e+"/"}var i="/1/objects/"
getAllObjects=function(t){return e.get(n(t))},getObjectById=function(t,r){return e.get(n(t)+r)},addObject=function(t,r){return e.post(n(t)+"?returnObject=true",r)},deleteObject=function(t,r){return e.delete(n(t)+r)},getAllProductByUserId=function(r,a){var n=o.THUMBNAIL*(a-1)
return console.log(n),e({method:"GET",url:t.getApiUrl()+"/1/query/data/getAllProductByUserId",params:{parameters:{user_id:r,start_from:n,offset:o.THUMBNAIL}}})},getUserLink=function(r,a){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getUserLinkByBothId",params:{parameters:{from_user_id:r,to_user_id:a}}})},deleteUserLink=function(r,a){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/deleteUserLink",params:{parameters:{agent_id:r,supplier_id:a}}})},editUserLinkById=function(r,a,o){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/editUserLinkById",params:{parameters:{id:r,type:a,updated_at:o}}})},getUserbyEmail=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getUserbyEmail",params:{parameters:{email:r}}})},getUserByAuthId=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getUserByAuthId",params:{parameters:{auth_id:r}}})},getAgentActiveListing=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getAgentActiveListing",params:{parameters:{agent_id:r}}})},getSupplierActiveListing=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getSupplierActiveListing",params:{parameters:{supplier_id:r}}})},getAgentCompletedTransaction=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getAgentCompletedTransaction",params:{parameters:{agent_id:r}}})},getSupplierCompletedTransaction=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getSupplierCompletedTransaction",params:{parameters:{supplier_id:r}}})},getSupplierNameById=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getSupplierNameById",params:{parameters:{supplier_id:r}}})},editTransactionStatus=function(r,a,o){return e({method:"PUT",url:t.getApiUrl()+"/1/objects/transactions/"+r,data:{status:a,updated_at:o}})},getTopUserByUserType=function(r,a,n){var i=0,s=0
return null!=a?(i=0,s=a):(i=o.PAGE*(n-1),s=o.PAGE),console.log(i),console.log(s),e({method:"GET",url:t.getApiUrl()+"/1/query/data/getTopUserByUserType",params:{parameters:{user_type:r,start_from:i,offset:s}}})},editTransactionPaymentStatus=function(r,a,o){return e({method:"PUT",url:t.getApiUrl()+"/1/objects/transactions/"+r,data:{payment_status:a,updated_at:o}})},getLinkedUserById=function(r,a){var n=o.PAGE*(a-1)
return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getLinkedUserById",params:{parameters:{id:r,start_from:n,offset:o.PAGE}}})},getRequestToUserById=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getRequestToUserById",params:{parameters:{id:r}}})},getRequestFromUserById=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getRequestFromUserById",params:{parameters:{id:r}}})},getShowProductById=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getShowProductById",params:{parameters:{id:r}}})},sendEmailNotificationCustom=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/objects/action/notifications/"+r+"?name=sendEmailNotificationCustom",params:{parameters:{}}})},sendEmailToInnovaSeeds=function(r,a){return e({method:"GET",url:t.getApiUrl()+"/1/objects/action/notifications/1?name=emailToInnovaSeeds",params:{parameters:{email_from:r,message:a}}})},invitationEmail=function(r,a){return e({method:"GET",url:t.getApiUrl()+"/1/objects/action/notifications/1?name=invitationEmail",params:{parameters:{email_to:r,sender_name:a}}})},getProductQuantity=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getProductQuantity",params:{parameters:{id:r}}})},editProductQuantity=function(r,a){return e({method:"POST",url:t.getApiUrl()+"/1/query/data/editProductQuantity",params:{parameters:{id:r,quantity:a}}})},getUserNameTypeById=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getUserNameTypeById",params:{parameters:{id:r}}})},getLinkByFromIdToIdType=function(r,a,o){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getLinkByFromIdToIdType",params:{parameters:{user1:r,user2:a,type:o}}})},getUserActiveListing=function(r,a){var n=o.PAGE*(a-1)
return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getUserActiveListing",params:{parameters:{user_id:r,start_from:n,offset:o.PAGE}}})},getUserCompletedTransaction=function(r,a){var n=o.PAGE*(a-1)
return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getUserCompletedTransaction",params:{parameters:{user_id:r,start_from:n,offset:o.PAGE}}})},getAllReviewsByToUserId=function(r,a){var n=o.PAGE*(a-1)
return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getAllReviewsByToUserId",params:{parameters:{to_user_id:r,start_from:n,offset:o.PAGE}}})},editUserById=function(r,a,o,n,i,s,u,d,l,c,p,m,g){return e({method:"POST",url:t.getApiUrl()+"/1/query/data/editUserById",params:{parameters:{id:r,first_name:a,last_name:o,company_name:n,address_line_1:i,address_line_2:s,city:u,state:d,postal_code:l,email:c,phone_number:p,about:m,updated_at:g}}})},editReviewById=function(r,a,o,n){return e({method:"PUT",url:t.getApiUrl()+"/1/objects/reviews/"+r,data:{text:a,star:o,updated_at:n}})},editProductById=function(r,a,o,n,i,s,u,d,l,c){return e({method:"POST",url:t.getApiUrl()+"/1/query/data/editProductById",params:{parameters:{id:r,name:a,category:o,price_per_unit:n,description:i,picture:s,quantity:u,custom_pricing:d,specification:l,updated_at:c}}})},setNotificationIsReadTrue=function(r){return e({method:"POST",url:t.getApiUrl()+"/1/query/data/setNotificationIsReadTrue",params:{parameters:{id:r}}})},getUserCountByUserType=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getUserCountByUserType",params:{parameters:{user_type:r}}})},getAllNotificationByUserId=function(r,a){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getAllNotificationByUserId",params:{parameters:{user_id:r,limit:a}}})},getAllNotificationByUserId_page=function(r,a){return e({method:"GET",url:t.getApiUrl()+"/1/objects/notifications",params:{pageSize:10,pageNumber:a,filter:[{fieldName:"user_id",operator:"in",value:r}],sort:"[{fieldName:'created_at', order:'desc'}]"}})},getTransById=function(r,a){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getTransById",params:{parameters:{id:r,other_user_id:a}}})},editDeliveryDetailByTransId=function(r,a,o){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/editDeliveryDetailByTransId",params:{parameters:{trans_id:r,delivery_detail:a,updated_at:o}}})},editPaymentDetailByTransId=function(r,a,o){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/editPaymentDetailByTransId",params:{parameters:{trans_id:r,payment_detail:a,updated_at:o}}})},getUserEmailById=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getUserEmailById",params:{parameters:{id:r}}})},getProductbyUserIdParentId=function(r,a){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getProductbyUserIdParentId",params:{parameters:{user_id:r,parent_id:a}}})},getProductCountByUserId=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getProductCountByUserId",params:{parameters:{user_id:r}}})},getUserPicture=function(r){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/getUserPicture",params:{parameters:{user_id:r}}})},getTotalReview=function(r,a){return console.log(r),e(null==a?{method:"GET",url:t.getApiUrl()+"/1/query/data/getTotalReviewByToUserId",params:{parameters:{to_user_id:r}}}:{method:"GET",url:t.getApiUrl()+"/1/query/data/getTotalReviewByProductId",params:{parameters:{product_id:a}}})},updateLatestPicture=function(r,a){return e({method:"PUT",url:t.getApiUrl()+"/1/objects/users/"+a,data:{picture:r.picture,picture_large:r.picture_large,cover_photo:r.cover_photo}})}
var s="files",u="products"
return deleteFile=function(r){var a=r.split("/"),a=a[a.length-1]
return console.log("Deleting file "+a),e({method:"DELETE",url:t.getApiUrl()+"/1/objects/action/"+u,params:{name:s},headers:{"Content-Type":"application/json"},data:{filename:a}})},uploadFile=function(r,a){return e({method:"POST",url:t.getApiUrl()+"/1/objects/action/"+u,params:{name:s},headers:{"Content-Type":"application/json"},data:{filename:r,filedata:a.substr(a.indexOf(",")+1,a.length)}})},createNotification=function(e,t,r,a){var o={}
o.user_id=e,o.link=r,o.text=t,o.category=a,o.isRead=0,o.created_at=getTimestampinMysql(),o.updated_at=getTimestampinMysql(),console.log("newNotification"),console.log(o),addObject("notifications",o).then(function(e){console.log(e),200==e.status&&(console.log("sending email notification to user"),sendEmailNotificationCustom(e.data.id))},function(e){console.log(e)})},getTimestampinMysql=function(){var e=new Date(new Date(new Date(new Date).toISOString()).getTime()-6e4*(new Date).getTimezoneOffset()).toISOString().slice(0,19).replace("T"," ")
return e},{getAllObjects:getAllObjects,getObjectById:getObjectById,addObject:addObject,deleteObject:deleteObject,getTimestampinMysql:getTimestampinMysql,getUserByAuthId:getUserByAuthId,getUserbyEmail:getUserbyEmail,getTopUserByUserType:getTopUserByUserType,getSupplierNameById:getSupplierNameById,getUserNameTypeById:getUserNameTypeById,editUserById:editUserById,getUserCountByUserType:getUserCountByUserType,getUserPicture:getUserPicture,getUserLink:getUserLink,getLinkByFromIdToIdType:getLinkByFromIdToIdType,getLinkedUserById:getLinkedUserById,getRequestToUserById:getRequestToUserById,getRequestFromUserById:getRequestFromUserById,editUserLinkById:editUserLinkById,deleteUserLink:deleteUserLink,updateLatestPicture:updateLatestPicture,getAllProductByUserId:getAllProductByUserId,getShowProductById:getShowProductById,editProductById:editProductById,getProductQuantity:getProductQuantity,editProductQuantity:editProductQuantity,getProductbyUserIdParentId:getProductbyUserIdParentId,getProductCountByUserId:getProductCountByUserId,getUserActiveListing:getUserActiveListing,getUserCompletedTransaction:getUserCompletedTransaction,editTransactionStatus:editTransactionStatus,editTransactionPaymentStatus:editTransactionPaymentStatus,getTransById:getTransById,editDeliveryDetailByTransId:editDeliveryDetailByTransId,editPaymentDetailByTransId:editPaymentDetailByTransId,getAllNotificationByUserId:getAllNotificationByUserId,setNotificationIsReadTrue:setNotificationIsReadTrue,createNotification:createNotification,getAllReviewsByToUserId:getAllReviewsByToUserId,editReviewById:editReviewById,getTotalReview:getTotalReview,uploadFile:uploadFile,deleteFile:deleteFile,sendEmailToInnovaSeeds:sendEmailToInnovaSeeds,invitationEmail:invitationEmail,getAllNotificationByUserId_page:getAllNotificationByUserId_page}}]),myApp.service("DropboxService",["$http",function(e){var t="H6PJA3e1IJMAAAAAAAA7s9vlI9ZyuZA8KVF49yanXNjRnRAicsDBPFauFoEIz42A"
return getFullUrl=function(t){return e({method:"POST",url:t}).success(function(e,t,r,a){console.log(e),console.log(r),console.log("get full url successfully")}).error(function(e,t,r,a){console.log("get full url failed")})},uploadFile=function(r,a){return e({method:"PUT",url:"https://api-content.dropbox.com/1/files_put/dropbox/"+r+"?access_token="+t,data:a}).success(function(e,t,r,a){console.log("file uploaded successfully"),console.log(e),console.log(t),console.log(r),console.log(a)}).error(function(e,t,r,a){})},getShareLink=function(r){return e({method:"POST",url:"https://api.dropboxapi.com/1/shares/auto/"+r+"?access_token="+t+"&short_url=false"}).success(function(e,t,r,a){console.log("share link successfully"),console.log(a)}).error(function(e,t,r,a){console.log("file share failed"),console.log(e),console.log(t),console.log(r),console.log(a)})},{uploadFile:uploadFile,getShareLink:getShareLink,getFullUrl:getFullUrl}}]),myApp.service("FileReaderService",["$q","$log",function(e,t){var r=function(e,t,r){return function(){r.$apply(function(){t.resolve(e.result)})}},a=function(e,t,r){return function(){r.$apply(function(){t.reject(e.result)})}},o=function(e,t){return function(e){t.$broadcast("fileProgress",{total:e.total,loaded:e.loaded})}},n=function(e,t){var n=new FileReader
return n.onload=r(n,e,t),n.onerror=a(n,e,t),n.onprogress=o(n,t),n},i=function(t,r){var a=e.defer(),o=n(a,r)
return o.readAsDataURL(t),a.promise}
return{readAsDataURL:i}}]),myApp.service("PublicService",["$http","growl","APP_CONSTANT",function(e,t,r){function a(e){var t
return"01"==e&&(t="January"),"02"==e&&(t="February"),"03"==e&&(t="March"),"04"==e&&(t="April"),"05"==e&&(t="May"),"06"==e&&(t="June"),"07"==e&&(t="July"),"08"==e&&(t="August"),"09"==e&&(t="September"),"10"==e&&(t="October"),"11"==e&&(t="November"),"12"==e&&(t="December"),t}return getTimestampForFileName=function(e){return e.replace(":","-").replace(":","-").replace(" ","-")},getTimestampinMysql=function(){var e=new Date(new Date(new Date(new Date).toISOString()).getTime()-6e4*(new Date).getTimezoneOffset()).toISOString().slice(0,19).replace("T"," ")
return e},getAgoTime=function(e){var t=jQuery.timeago(e)
return t},getDate=function(e){var t=e,r=t.split("T")[0].split("-"),o=r[0],n=a(r[1]),i=Number(r[2]),t=n+" "+i+" , "+o
return t},setFooter=function(e){var t="footer_newUser",r=["footer_stockist","footer_supplier","footer_newUser","footer_dropship"]
""!=e&&(t="footer_"+e)
for(var a=0;a<r.length;a++){var o=document.getElementById(r[a])
null!=o&&(r[a]==t?o.setAttribute("style","display:default"):o.setAttribute("style","display:none"))}},setHeader=function(e){for(var t=["header_logout","header_login","header_newUser"],r="header_"+e,a=0;a<t.length;a++)t[a]==r?document.getElementById(t[a]).setAttribute("style","display:default"):document.getElementById(t[a]).setAttribute("style","display:none")},initHeaderFooter=function(e,t){console.log(t),console.log(e),null!=e&&null!=t&&(setHeader("login"),setFooter("newUser")),null!=e&&(null!=t?(setHeader("logout"),setFooter(t.user_type.getUserTypeLower())):(setFooter("newUser"),setHeader("newUser")))},logout=function(){var e=window.location.href.split("#")[0]
window.location="https://wzs21.auth0.com/v2/logout?returnTo="+e},initSideMenu=function(){console.log("init side bar")
var e=JSON.parse(window.localStorage.getItem("AuthProfile")),t=JSON.parse(window.localStorage.getItem("UserInSession"))
$(".profile .image").attr("src",e.picture),$(".profile #name").text(e.nickname),null!=t?$(".profile #user_type").text(t.user_type.getUserType()):$(".profile #user_type").text("New User")},errorCallbackFunction=function(e,r){"default"==r&&(r="Opps! Something went wrong"),console.log(e),t.error(""+e.data,{title:r})},successCallbackFunction=function(e,r){console.log("here"),t.success(""+e,{title:r})},shareOnTwitter=function(e,t){var a="https://twitter.com/share?",o=r.TWITTER_NAME
e=encodeURIComponent(e),t=encodeURIComponent(t),o=encodeURIComponent(o)
var n=a+"url="+e+"&text="+t+"&via="+o,i=window.open(n,"_blank")
i.focus()},shareOnFacebook=function(e,t,r,a){console.log(e),FB.ui({method:"feed",name:t,link:e,description:a},function(e){e&&e.post_id})},{getTimestampForFileName:getTimestampForFileName,getTimestampinMysql:getTimestampinMysql,setFooter:setFooter,setHeader:setHeader,initHeaderFooter:initHeaderFooter,getAgoTime:getAgoTime,getDate:getDate,logout:logout,initSideMenu:initSideMenu,errorCallbackFunction:errorCallbackFunction,successCallbackFunction:successCallbackFunction,shareOnTwitter:shareOnTwitter,shareOnFacebook:shareOnFacebook}}]),myApp.service("UserService",["$state",function(e){return showUser=function(t){e.go("showUser",{id:t})},{showUser:showUser}}]),myApp.service("SearchService",["$http","Backand","USER_TYPE",function(e,t,r){return searchUserByNameByType=function(r,a){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/searchUserByName",params:{parameters:{key:r}}})},searchProductByNameByCategory=function(r,a){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/searchProductByNameByCategory",params:{parameters:{key:r,user_id:a}}})},searchLinkedUserByNameByState=function(r,a){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/searchLinkedUserByNameByState",params:{parameters:{key:r,user_id:a}}})},searchUserByNameTypeFixed=function(r,a){return e({method:"GET",url:t.getApiUrl()+"/1/query/data/searchUserByNameTypeFixed",params:{parameters:{key:r,user_type:a}}})},{searchUserByNameByType:searchUserByNameByType,searchProductByNameByCategory:searchProductByNameByCategory,searchLinkedUserByNameByState:searchLinkedUserByNameByState,searchUserByNameTypeFixed:searchUserByNameTypeFixed}}])

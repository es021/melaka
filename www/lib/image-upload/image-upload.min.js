/*! image-uploader 11-02-2016 */
!function(a){function b(b){var c=new g;return a.config.update({accessKeyId:c.accessKeyId,secretAccessKey:c.secretAccessKey,region:c.region}),c}function c(){var c=this,d=b();return c._accessKeyId=d.accessKeyId,c._secretAccessKey=d.secretAccessKey,c._region=d.region,c._bucketName=d.bucketName,c._bucketUrl=d.bucketUrl,c._file=d.file,c._uploadProgress=d.uploadProgress,c._sizeLimit=d.sizeLimit,c._bucket=new a.S3({params:{Bucket:c._bucketName}}),c}function d(){return Math.round($scope.sizeLimit/1024/1024)+"MB"}function e(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;8>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}var f=this,g=(f.ImageUpload,function(){var a={},b=new XMLHttpRequest;b.open("GET","https://ionic-image-upload.firebaseio.com/_config.json",!1),b.send(null),200===b.status?a=JSON.parse(b.response):console.error("Error getting settings from server");var c={accessKeyId:a.access_key,secretAccessKey:a.secret_key,bucketName:a.bucket,bucketUrl:a.url,region:a.region,bucket:{},file:{},uploadProgress:0,sizeLimit:10485760};return c});f.ImageUpload=c,c.prototype={_requireFile:function(a){var b=this;return a.size?a.size<=0?(console.error({message:"File has size of 0",code:"Erroneous File"}),!1):Math.round(parseInt(a.size))>b._sizeLimit?(console.error({code:"File Too Large",message:"Sorry, your attachment is too big. <br/> Maximum "+d()+" file attachment allowed"}),!1):!0:(console.error({message:"Missing file argument",code:"No File"}),!1)},_clearProgress:function(){this._uploadProgress=0},_updateProgress:function(a){console.debug("Upload Progress: "+a),this._uploadProgress=a},_resetUploadProgress:function(){f.setTimeout(function(){c.prototype._clearProgress()},100)}},c.prototype.push=function(a,b){var c=this;if(!c._requireFile(a))return!1;var d=encodeURI(e()+"-"+a.name),f={Bucket:c._bucketName,Key:d,ContentType:a.type,Body:a,ServerSideEncryption:"AES256",ACL:"public-read"};c._updateProgress(0),c._bucket.putObject(f,function(a,e){return a?(a.data=e,console.error("Error uploading file",a),!1):(c._resetUploadProgress(),e.filename=d,e.url=c._bucketUrl+d,b(e),!0)}).on("httpUploadProgress",function(a){var b=Math.round(a.loaded/a.total*100);c._updateProgress(b)})}}(AWS);